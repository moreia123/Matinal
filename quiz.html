<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Rotina Matinais Maxcell</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALiQ04FR2WZpaEkR20HUr1AVDS31QBQkU",
            authDomain: "matinal-3dab3.firebaseapp.com",
            projectId: "matinal-3dab3",
            storageBucket: "matinal-3dab3.firebasestorage.app",
            messagingSenderId: "168000386914",
            appId: "1:168000386914:web:f0f71c16e81e974586de3b",
            measurementId: "G-XFC6LTQ7VL"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>
    <div class="container">
        <h1>Quiz: <span id="quiz-day"></span></h1>
        <div id="login">
            <h2>Cadastro de Vendedor</h2>
            <form id="login-form">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" placeholder="Digite seu nome" required>
                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" placeholder="Digite seu CPF" required>
                <button type="submit">Iniciar Quiz</button>
            </form>
        </div>
        <div id="quiz" style="display: none;">
            <div id="questions"></div>
            <div class="timer" id="timer">10</div>
            <div id="result"></div>
        </div>
    </div>

    <script>
        let currentQuestionIndex = 0;
        let timerInterval;
        let questions = [];
        let vendedor = null;

        // Função para cadastrar ou buscar vendedor
        function cadastrarVendedor(nome, cpf) {
            return database.ref('vendedores').orderByChild('cpf').equalTo(cpf).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        // Vendedor já cadastrado
                        const data = snapshot.val();
                        vendedor = {
                            id: Object.keys(data)[0],
                            nome: data[Object.keys(data)[0]].nome,
                            cpf: cpf
                        };
                    } else {
                        // Cadastra novo vendedor
                        const novoVendedor = {
                            nome: nome,
                            cpf: cpf
                        };
                        return database.ref('vendedores').push(novoVendedor)
                            .then((ref) => {
                                vendedor = {
                                    id: ref.key,
                                    nome: nome,
                                    cpf: cpf
                                };
                            });
                    }
                });
        }

        // Função para iniciar o quiz
        document.getElementById('login-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const cpf = document.getElementById('cpf').value;

            cadastrarVendedor(nome, cpf)
                .then(() => {
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('quiz').style.display = 'block';
                    const urlParams = new URLSearchParams(window.location.search);
                    const day = urlParams.get('day');
                    loadQuestions(day);
                })
                .catch((error) => {
                    alert("Erro ao cadastrar vendedor: " + error.message);
                });
        });

        // Restante do código do quiz...
    </script>
</body>
</html>
